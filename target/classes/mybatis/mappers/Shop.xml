<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="Shop">
	<select id="shopList" resultType="Shop">
		<![CDATA[SELECT * FROM Shop]]> 		
	</select>
	
	<resultMap type="Shop" id="ShopResult">
		<id property="shop_id" column="SHOP_ID"/>
		<result property="user_email" column="USER_EMAIL"/>
		<result property="shop_idx" column="SHOP_IDX"/>
		<result property="shop_title" column="SHOP_TITLE"/>
		<result property="shop_addr" column="SHOP_ADDR"/>
		<result property="shop_location" column="SHOP_LOCATION"/>
		<result property="shop_type" column="SHOP_TYPE"/>
		<result property="shop_tip" column="SHOP_TIP"/>
		<result property="budget" column="BUDGET"/>
		<result property="shop_reserve" column="SHOP_RESERVE"/>
		<result property="shop_comment" column="SHOP_COMMENT"/>
		<result property="shop_view" column="SHOP_VIEW"/>
		<result property="shop_score" column="SHOP_SCORE"/>
		<result property="shop_dibs" column="SHOP_DIBS"/>
		<result property="shop_phone" column="SHOP_PHONE"/>
		<result property="shop_time" column="SHOP_TIME"/>
		<result property="shop_addinfo" column="SHOP_ADDINFO"/>
		<result property="shop_tb" column="SHOP_TB"/>
		<result property="shop_alcohol" column="SHOP_ALCOHOL"/>
		<result property="shop_car" column="SHOP_CAR"/>
		<result property="shop_close" column="SHOP_CLOSE"/>
		<result property="shop_review" column="SHOP_REVIEW"/>		
	</resultMap>
	
	<select id="shopSearch" resultType="Shop" parameterType="hashMap">
		select * from Shop where 1=1
		<if test="location != null">
			and SHOP_LOCATION = #{location}
		</if>

		<if test="shop_addrArr != null">
			and
			<foreach collection="shop_addrArr" item="shop_addr" index="index"
				separator="or">
				SHOP_ADDR like '%' || #{shop_addr} || '%'</foreach>
		</if>

		<if test="food_typeArr != null">
			and FOOD_TYPE IN
			<foreach collection="food_typeArr" item="food_type" index="index"
				open="(" separator="," close=")">
				#{food_type}
			</foreach>
		</if>

		<if test="string_search != null">
			and(
			SHOP_TITLE like '%' || #{string_search} || '%'
			or
			SHOP_ADDR like '%' || #{string_search} || '%'
			or
			SHOP_LOCATION like '%' || #{string_search} || '%'
			or
			FOOD_TYPE like '%' || #{string_search} || '%'
			)
		</if>

		<if test="solt != null">
			<if test='solt == "1"'>
				order by SHOP_SCORE DESC
			</if>
			<if test='solt == "2"'>
				order by SHOP_RESERVE DESC
			</if>
			<if test='solt == "3"'>
				order by SHOP_VIEW DESC
			</if>
		</if>

	</select>

	<select id="shopOne" parameterType="int" resultType="Shop">
	<!-- 가게정보 -->
		<![CDATA[
		SELECT * FROM Shop WHERE shop_idx=#{Shop_idx}
		]]>		
	</select>
	
	<select id="shopOwnerList" parameterType="String" resultType="Shop">
		<!-- 가게정보 -->
		<![CDATA[
		SELECT * FROM Shop WHERE user_email=#{user_email}
		]]>
	</select>
	
	<select id="cntShopReserve" resultType="Shop">
		<![CDATA[
			SELECT SUM(shop_reserve)
			FROM Shop
		]]>
	</select>
	
	<insert id="shopInsert" parameterType="Shop">
		<![CDATA[
		INSERT INTO Shop(shop_id, user_email, seq_shop_idx, shop_title, shop_addr, 
						shop_location, food_type, shop_tip, budget, shop_reserve,
						shop_comment, shop_view, shop_score, shop_dibs, shop_phone,
						shop_time, shop_addinfo, shop_tb, shop_alcohol, shop_car, shop_close)
		VALUES(#{shop_id}, #{user_email}, #{seq_shop_idx}, #{shop_title}, #{shop_addr}, 
						#{shop_location}, #{food_type}, #{shop_tip}, #{budget}, #{shop_reserve},
						#{shop_comment}, #{shop_view}, #{shop_score}, #{shop_dibs}, #{shop_phone},
						#{shop_time}, #{shop_addinfo}, #{shop_tb}, #{shop_alcohol}, #{shop_car}, #{shop_close})
		]]>
	</insert>
	
	<update id="shopUpdate" parameterType="Shop">
		<![CDATA[
		UPDATE Shop set shop_title=#{shop_title}, shop_addr=#{shop_addr}, 
						shop_location=#{shop_location}, food_type=#{food_type}, 
						shop_tip=#{shop_tip}, budget=#{budget}, shop_comment=#{shop_comment},
						shop_phone=#{shop_phone}, shop_time=#{shop_time},
						shop_addinfo=#{shop_addinfo}, shop_tb=#{shop_tb}, shop_alcohol=#{shop_alcohol},
						shop_car=#{shop_car}, shop_close=#{shop_close}
		WHERE shop_id=#{shop_id}
		]]>
	</update>
	
	<delete id="shopDelete" parameterType="Shop">
		<![CDATA[
		DELETE Shop WHERE shop_id=#{shop_id}
		]]>
	</delete>
</mapper>